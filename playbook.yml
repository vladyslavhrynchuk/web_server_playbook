- name: Update_and_upgrade_apt_packages
  hosts: all
  become: true
  tasks:
    - apt:
        upgrade: "yes"
        update_cache: "yes"

- name: Install_and_configure_mysql
  become: true
  hosts: db_hosts
  roles:
    - mysql

- name: Install_and_configure_web_server
  become: true
  hosts: web_hosts
  roles:
    - web_server

- name: Start_web_server
  become: true
  hosts: web_hosts
  environment:
    MYSQL_DATABASE_HOST: "{{ hostvars[groups['db_hosts'][0]].ansible_host }}"
  tasks:
    - shell: "FLASK_APP=/home/ubuntu/simple-webapp/app.py nohup flask run --host=0.0.0.0 &"
